<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storico Prestazioni</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        select { margin-bottom: 10px; padding: 5px; }
    </style>
</head>
<body>

    <h2>Storico Prestazioni Sportive</h2>
    <h3>Filtra per:</h3>
    <label for="sportFilter">sport</label>
    <select id="sportFilter">
        <option value="tutti">Tutti</option>
        <option value="calcio">Calcio</option>
        <option value="basket">Basket</option>
        <option value="tennis">Tennis</option>
    </select>
    <label for="orderFilter">tempo</label>
    <select id="orderFilter">
        <option value="default">default(momento inserimento)</option>
        <option value="data">data evento</option>
    </select>
    <table id="prestazioniTable">
        <thead>
            <tr>
                <th>Data Evento</th>
                <th>Sport</th>
                <th>Momento Inserimento</th>
                <th>Dettagli</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
       document.addEventListener("DOMContentLoaded", function () {
        const sportFilter = document.getElementById("sportFilter"); // Filtro sport
        const orderFilter = document.getElementById("orderFilter"); // Filtro ordinamento
        const tableBody = document.querySelector("#prestazioniTable tbody");
        let prestazioniData = []; // Salviamo i dati ricevuti

        function fetchData() {
            fetch("recupero_dati.php")
                .then(response => response.json())
                .then(data => {
                    prestazioniData = data;
                    updateTable();
                })
                .catch(error => console.error("Errore nel recupero dati:", error));
        }

        function updateTable() {
            const selectedSport = sportFilter.value;
            const selectedOrder = orderFilter.value;

            // Filtriamo per sport
            let filteredData = prestazioniData.filter(row => selectedSport === "tutti" || row.sport === selectedSport);

           // Ordina i dati in base alla selezione dell'utente
           let sortedData = prestazioniData.sort((a, b) => {
           let dateA = selectedOrder === "evento" ? new Date(a.data) : new Date(a.created_at);
           let dateB = selectedOrder === "evento" ? new Date(b.data) : new Date(b.created_at);
           return dateB - dateA; // Ordine decrescente
        });

            tableBody.innerHTML = ""; // Pulisce la tabella

                prestazioniData.forEach(row => {
                    if (selectedSport === "tutti" || row.sport === selectedSport) {
                        let dettagli = "";
                        if (row.dettagli) {
                            if (row.sport === "calcio") {
                                dettagli = `Minuti giocati: ${row.dettagli.minuti}, Gol: ${row.dettagli.gol}, Tiri : ${row.dettagli.tiri}, Tiri in porta: ${row.dettagli.tiri_porta}, Assist: ${row.dettagli.assist}, Passaggi tentati: ${row.dettagli.passaggi_tentati}, Passaggi riusciti: ${row.dettagli.passaggi_riusciti}, Intercetti: ${row.dettagli.intercetti}, Contrasti: ${row.dettagli.contrasti}, Palle recuperate: ${row.dettagli.palle_recuperate}, Dribbling tentati: ${row.dettagli.dribbling_tentati}, Dribbling riusciti: ${row.dettagli.dribbling_riusciti}`;
                            } else if (row.sport === "basket") {
                                dettagli = `Minuti giocati: ${row.dettagli.minuti}, Punti : ${row.dettagli.punti}, Tiri tentati : ${row.dettagli.tiri_tentati}, Tiri realizzati : ${row.dettagli.tiri_realizzati}, Tiri da 3 tentati: ${row.dettagli.tiri3_tentati}, Tiri da 3 realizzati: ${row.dettagli.tiri3_realizzati}, Tiri liberi tentati: ${row.dettagli.tiri_liberi_tentati}, Tiri liberi realizzati: ${row.dettagli.tiri_liberi_realizzati}, Rimbalzi totali: ${row.dettagli.rimbalzi_totali}, Rimbalzi offensivi: ${row.dettagli.rimbalzi_offensivi}, Rimbalzi difensivi: ${row.dettagli.rimbalzi_difensivi}, Assist: ${row.dettagli.assist}, Stoppate: ${row.dettagli.stoppate}, Palle rubate: ${row.dettagli.palle_rubate}, Palle perse: ${row.dettagli.palle_perse}`;
                            } else if (row.sport === "tennis") {
                                dettagli = `Minuti giocati: ${row.dettagli.tempo}, Punti giocati : ${row.dettagli.punti_giocati}, Punti vinti : ${row.dettagli.punti_vinti}, Prima giocate : ${row.dettagli.prima_giocate}, Prima campo : ${row.dettagli.prima_campo}, Prima vinte : ${row.dettagli.prima_vinte}, Seconda campo : ${row.dettagli.seconda_campo}, Seconda vinte : ${row.dettagli.seconda_vinte}, Doppi falli : ${row.dettagli.doppi_falli}, Risposte giocate : ${row.dettagli.risposta_giocati}, Risposte vinte : ${row.dettagli.risposta_vinti}, Break punti : ${row.dettagli.break_punti}, Break convertiti : ${row.dettagli.break_convertiti}, Errori : ${row.dettagli.errori}`;
                            }
                        }

                        let tr = document.createElement("tr");
                        tr.innerHTML = `
                            <td>${row.data || "N/A"}</td>
                            <td>${row.sport}</td>
                            <td>${row.created_at || "N/A"}</td>
                            <td>${dettagli}</td>
                            <td>${row.dettagli ? JSON.stringify(row.dettagli) : "N/A"}</td>
                        `;
                        tableBody.appendChild(tr);
                    }
                    });
                }
                sportFilter.addEventListener("change", updateTable); 
                orderFilter.addEventListener("change", updateTable);
                fetchData();
        });
    </script>

</body>
</html>
